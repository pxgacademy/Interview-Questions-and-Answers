# 14. Monorepo & Module Federation with Turborepo

**মনোরেপো** এবং **মডিউল ফেডারেশন** হল আধুনিক ওয়েব ডেভেলপমেন্টে ব্যবহৃত দুটি শক্তিশালী কৌশল, যা বড় আকারের প্রকল্প পরিচালনা এবং মাইক্রোফ্রন্টএন্ড আর্কিটেকচারে সহায়তা করে। Next.js এবং **টার্বোরেপো** (Turborepo)-এর সাথে এই কৌশলগুলো ব্যবহার করলে ডেভেলপার টিমগুলো আরও দক্ষতার সাথে কাজ করতে পারে, কোড শেয়ারিং সহজ হয়, এবং বিল্ড প্রক্রিয়া ত্বরান্বিত হয়। সিনিয়র ডেভেলপারদের জন্য এই প্যাটার্নগুলো বোঝা এবং সঠিকভাবে বাস্তবায়ন করা অ্যাপ্লিকেশনের স্কেলেবিলিটি, মেইনটেন্যান্স, এবং টিম সহযোগিতা উন্নত করতে গুরুত্বপূর্ণ। এই বিস্তারিত আলোচনায় আমরা মনোরেপো, মডিউল ফেডারেশন, এবং টার্বোরেপোর সাথে এদের ব্যবহার নিয়ে বাংলায় আলোচনা করব।

---

## মনোরেপো এবং মডিউল ফেডারেশন কী?

1. **মনোরেপো**:
   - মনোরেপো হল একটি একক গিট রিপোজিটরি যেখানে একাধিক প্রকল্প বা প্যাকেজ সংরক্ষিত থাকে। এটি পলিরেপো (প্রতিটি প্রকল্পের জন্য আলাদা রিপোজিটরি)-এর বিপরীত।
   - উদাহরণ: একটি মনোরেপোতে দুটি Next.js অ্যাপ্লিকেশন (`web`, `docs`) এবং শেয়ারড প্যাকেজ (যেমন UI লাইব্রেরি) থাকতে পারে।
   - সুবিধা:
     - কোড শেয়ারিং সহজ।
     - একক কনফিগারেশন (যেমন `tsconfig.json`, `eslint`)।
     - দ্রুত বিল্ড এবং CI/CD পাইপলাইন।
   - চ্যালেঞ্জ:
     - বড় রিপোজিটরি ম্যানেজ করা জটিল হতে পারে।
     - ডিপেনডেন্সি কাপলিং।

2. **মডিউল ফেডারেশন**:
   - মডিউল ফেডারেশন হল Webpack 5-এর একটি ফিচার, যা একাধিক স্বাধীনভাবে ডিপ্লয় করা অ্যাপ্লিকেশনের মধ্যে কোড এবং কম্পোনেন্ট শেয়ার করতে দেয়।
   - উদাহরণ: একটি অ্যাপ (শেল) অন্য অ্যাপ থেকে কম্পোনেন্ট বা মডিউল লেজি-লোড করতে পারে।
   - সুবিধা:
     - স্বাধীন ডিপ্লয়মেন্ট।
     - মাইক্রোফ্রন্টএন্ড আর্কিটেকচার সমর্থন।
     - শেয়ারড ডিপেনডেন্সি বান্ডলিং।
   - চ্যালেঞ্জ:
     - কনফিগারেশন জটিল হতে পারে।
     - রানটাইম পারফরম্যান্স অপটিমাইজেশন প্রয়োজন।

3. **টার্বোরেপো**:
   - টার্বোরেপো হল Vercel-এর তৈরি একটি হাই-পারফরম্যান্স বিল্ড সিস্টেম, যা মনোরেপো ম্যানেজমেন্ট এবং টাস্ক অর্কেস্ট্রেশনের জন্য ব্যবহৃত হয়।
   - বৈশিষ্ট্য:
     - ইনক্রিমেন্টাল বিল্ড।
     - প্যারালাল টাস্ক এক্সিকিউশন।
     - রিমোট ক্যাশিং।
   - Next.js-এর সাথে টার্বোরেপো ব্যবহার করে বিল্ড, লিন্টিং, এবং টেস্টিং দ্রুত করা যায়।

---

## টার্বোরেপোর সাথে মনোরেপো সেটআপ

টার্বোরেপো মনোরেপো ম্যানেজ করতে সহজ এবং দ্রুত সমাধান প্রদান করে। এটি Yarn, npm, বা pnpm-এর ওয়ার্কস্পেস ফিচারের সাথে কাজ করে।

### সেটআপ প্রক্রিয়া:

1. **টার্বোরেপো ইনিশিয়ালাইজ করা**:
   ```bash
   npx create-turbo@latest
   ```
   - এটি একটি মনোরেপো স্ট্রাকচার তৈরি করবে, যেখানে থাকবে:
     - `apps/`: Next.js অ্যাপ্লিকেশন (যেমন `web`, `docs`)।
     - `packages/`: শেয়ারড প্যাকেজ (যেমন UI, কনফিগারেশন)।
     - `turbo.json`: টার্বোরেপোর কনফিগারেশন ফাইল।
     - `package.json`: ওয়ার্কস্পেস এবং ডিপেনডেন্সি ম্যানেজমেন্ট।

2. **ফোল্ডার স্ট্রাকচার**:
   ```
   my-turborepo/
   ├── apps/
   │   ├── web/ (Next.js অ্যাপ)
   │   └── docs/ (Next.js অ্যাপ)
   ├── packages/
   │   ├── ui/ (শেয়ারড কম্পোনেন্ট)
   │   ├── eslint-config/ (লিন্টিং কনফিগ)
   │   └── tsconfig/ (টাইপস্ক্রিপ্ট কনফিগ)
   ├── package.json
   └── turbo.json
   ```

3. **টার্বোরেপো কনফিগারেশন** (`turbo.json`):
   ```json
   {
     "$schema": "https://turbo.build/schema.json",
     "pipeline": {
       "build": {
         "outputs": [".next/**", "!.next/cache/**"],
         "dependsOn": ["^build"]
       },
       "lint": {},
       "dev": {
         "cache": false
       }
     }
   }
   ```
   - `build`: প্রতিটি প্যাকেজের বিল্ড টাস্ক।
   - `dependsOn`: ডিপেনডেন্সি প্যাকেজ বিল্ড হওয়ার আগে বিল্ড করা।
   - `cache`: বিল্ড আউটপুট ক্যাশ করে পুনরাবৃত্তি এড়ানো।

4. **কমান্ড**:
   - বিল্ড করতে: `turbo run build`
   - ডেভেলপমেন্ট মোডে রান করতে: `turbo run dev`
   - নির্দিষ্ট প্যাকেজ রান করতে: `turbo run dev --filter=web`

### উদাহরণ (শেয়ারড UI প্যাকেজ):

```jsx
// packages/ui/components/Button.js
export function Button({ children }) {
  return <button className="bg-blue-500 text-white p-2">{children}</button>;
}
```

```jsx
// apps/web/app/page.js
import { Button } from "@repo/ui/components/Button";

export default function Page() {
  return (
    <div>
      <Button>ক্লিক করুন</Button>
    </div>
  );
}
```

```json
// apps/web/package.json
{
  "dependencies": {
    "@repo/ui": "workspace:*"
  }
}
```

---

## মডিউল ফেডারেশন

মডিউল ফেডারেশন Next.js অ্যাপ্লিকেশনের মধ্যে কম্পোনেন্ট বা মডিউল শেয়ার করতে দেয়। এটি মাইক্রোফ্রন্টএন্ড আর্কিটেকচারের জন্য উপযুক্ত, যেখানে একটি শেল অ্যাপ অন্য অ্যাপ থেকে কম্পোনেন্ট লেজি-লোড করে।

### কনফিগারেশন:

1. **শেল অ্যাপে মডিউল ফেডারেশন**:
   ```javascript
   // apps/web/next.config.js
   const { withModuleFederation } = require("@module-federation/nextjs-mf");

   module.exports = withModuleFederation({
     name: "shell",
     remotes: {
       remoteApp: "remoteApp@http://localhost:3001/remoteEntry.js",
     },
     exposes: {
       "./Header": "./components/Header.js",
     },
     shared: {
       react: { singleton: true, eager: true },
       "react-dom": { singleton: true, eager: true },
     },
   });
   ```

2. **রিমোট অ্যাপে মডিউল ফেডারেশন**:
   ```javascript
   // apps/docs/next.config.js
   const { withModuleFederation } = require("@module-federation/nextjs-mf");

   module.exports = withModuleFederation({
     name: "remoteApp",
     exposes: {
       "./DocsPage": "./app/page.js",
     },
     shared: {
       react: { singleton: true, eager: true },
       "react-dom": { singleton: true, eager: true },
     },
   });
   ```

3. **শেল অ্যাপে রিমোট কম্পোনেন্ট লোড**:
   ```jsx
   // apps/web/app/page.js
   "use client";
   import dynamic from "next/dynamic";

   const DocsPage = dynamic(() => import("remoteApp/DocsPage"), { ssr: false });

   export default function Page() {
     return (
       <div>
         <h1>শেল অ্যাপ</h1>
         <DocsPage />
       </div>
     );
   }
   ```

### মডিউল ফেডারেশনের বৈশিষ্ট্য:
- **লেজি লোডিং**: রানটাইমে কম্পোনেন্ট লোড।
- **শেয়ারড ডিপেনডেন্সি**: React, ReactDOM-এর মতো লাইব্রেরি শেয়ার করা।
- **স্বাধীন ডিপ্লয়মেন্ট**: প্রতিটি অ্যাপ আলাদাভাবে ডিপ্লয় করা যায়।
- **মাইক্রোফ্রন্টএন্ড**: টিম-ভিত্তিক স্বাধীন ডেভেলপমেন্ট সমর্থন।

---

## টার্বোরেপোর সাথে মডিউল ফেডারেশন

টার্বোরেপো এবং মডিউল ফেডারেশন একসাথে ব্যবহার করলে মনোরেপোর মধ্যে মাইক্রোফ্রন্টএন্ড আর্কিটেকচার তৈরি করা যায়। টার্বোরেপো বিল্ড প্রক্রিয়া অপটিমাইজ করে, আর মডিউল ফেডারেশন রানটাইমে কম্পোনেন্ট শেয়ার করে।

### উদাহরণ (টার্বোরেপো + মডিউল ফেডারেশন):

1. **মনোরেপো স্ট্রাকচার**:
   ```
   my-turborepo/
   ├── apps/
   │   ├── shell/ (Next.js শেল অ্যাপ)
   │   └── remote/ (Next.js রিমোট অ্যাপ)
   ├── packages/
   │   ├── ui/ (শেয়ারড কম্পোনেন্ট)
   │   └── config/ (শেয়ারড কনফিগ)
   ├── package.json
   └── turbo.json
   ```

2. **টার্বোরেপো কনফিগারেশন**:
   ```json
   {
     "pipeline": {
       "build": {
         "outputs": [".next/**"],
         "dependsOn": ["^build"]
       },
       "dev": {
         "cache": false
       }
     }
   }
   ```

3. **মডিউল ফেডারেশন কনফিগারেশন**:
   - শেল অ্যাপে রিমোট অ্যাপ থেকে কম্পোনেন্ট লোড।
   - শেয়ারড UI প্যাকেজ ব্যবহার।

4. **কমান্ড**:
   ```bash
   turbo run dev --filter=shell --filter=remote
   ```

### সুবিধা:
- **দ্রুত বিল্ড**: টার্বোরেপোর ক্যাশিং এবং প্যারালাল বিল্ড।
- **কোড শেয়ারিং**: মডিউল ফেডারেশনের মাধ্যমে রানটাইমে কম্পোনেন্ট শেয়ার।
- **টিম স্বাধীনতা**: মাইক্রোফ্রন্টএন্ডের মাধ্যমে স্বাধীন ডিপ্লয়মেন্ট।

---

## ব্যবহারের ক্ষেত্র

1. **ই-কমার্স**:
   - মনোরেপো: `web` (স্টোর), `admin` (ড্যাশবোর্ড), এবং শেয়ারড `ui` প্যাকেজ।
   - মডিউল ফেডারেশন: `web`-এর মধ্যে `admin`-এর কম্পোনেন্ট লেজি-লোড।
2. **ডকুমেন্টেশন সাইট**:
   - মনোরেপো: `docs` অ্যাপ এবং শেয়ারড `ui` প্যাকেজ।
   - মডিউল ফেডারেশন: শেল অ্যাপে `docs` থেকে পেজ লোড।
3. **এন্টারপ্রাইজ অ্যাপ**:
   - মনোরেপো: একাধিক টিমের জন্য আলাদা অ্যাপ।
   - মডিউল ফেডারেশন: টিম-নির্দিষ্ট কম্পোনেন্ট শেয়ার।

---

## সিনিয়র ডেভেলপারদের জন্য গুরুত্বপূর্ণ টিপস

1. **টার্বোরেপো অপটিমাইজেশন**:
   - **রিমোট ক্যাশিং**: Vercel-এর রিমোট ক্যাশিং সক্রিয় করুন।
     ```bash
     turbo login
     turbo link
     ```
   - **ইনক্রিমেন্টাল বিল্ড**: `turbo.json`-এ সঠিক আউটপুট সেট করুন।
   - **ফিল্টারিং**: নির্দিষ্ট প্যাকেজের জন্য `--filter` ব্যবহার করুন।
     ```bash
     turbo run build --filter=web
     ```

2. **মডিউল ফেডারেশন অপটিমাইজেশন**:
   - **শেয়ারড ডিপেনডেন্সি**: `shared` অপশনে React, ReactDOM সিঙ্গলটন করুন।
   - **লেজি লোডিং**: `next/dynamic` ব্যবহার করে রানটাইমে কম্পোনেন্ট লোড করুন।
   - **ভার্সন ম্যানেজমেন্ট**: শেয়ারড ডিপেনডেন্সির ভার্সন মিসম্যাচ এড়ান।

3. **পারফরম্যান্স**:
   - টার্বোরেপোর ক্যাশিং ব্যবহার করে বিল্ড টাইম কমান।
   - মডিউল ফেডারেশনে রিমোট এন্ট্রি ফাইল ক্যাশ করুন।
     ```javascript
     headers: [
       {
         source: "/remoteEntry.js",
         headers: [
           {
             key: "Cache-Control",
             value: "public, max-age=31536000, immutable",
           },
         ],
       },
     ];
     ```

4. **এরর হ্যান্ডলিং**:
   - রিমোট মডিউল লোড ব্যর্থ হলে ফলব্যাক কম্পোনেন্ট ব্যবহার করুন।
     ```jsx
     const DocsPage = dynamic(() => import("remoteApp/DocsPage").catch(() => () => <div>এরর</div>), { ssr: false });
     ```

5. **টেস্টিং**:
   - মনোরেপোর জন্য Jest বা Playwright দিয়ে টেস্ট সেটআপ করুন।
   - মডিউল ফেডারেশন টেস্ট করতে মক রিমোট এন্ট্রি ব্যবহার করুন।

6. **সিকিউরিটি**:
   - মডিউল ফেডারেশনে রিমোট এন্ট্রি URL সুরক্ষিত করুন (HTTPS)।
   - মনোরেপোতে অ্যাক্সেস কন্ট্রোল সেট করুন।

7. **CI/CD ইন্টিগ্রেশন**:
   - GitHub Actions বা Vercel-এর সাথে টার্বোরেপো ইন্টিগ্রেট করুন।
   - মডিউল ফেডারেশনের জন্য আলাদা ডিপ্লয় পাইপলাইন সেট করুন।

---

## সুবিধা এবং চ্যালেঞ্জ

### মনোরেপো:
- **সুবিধা**:
  - কোড শেয়ারিং এবং একক কনফিগারেশন।
  - দ্রুত বিল্ড এবং টাস্ক অর্কেস্ট্রেশন।
  - টিম সহযোগিতা বৃদ্ধি।
- **চ্যালেঞ্জ**:
  - বড় রিপোজিটরি ম্যানেজমেন্ট।
  - ডিপেনডেন্সি কনফ্লিক্ট।

### মডিউল ফেডারেশন:
- **সুবিধা**:
  - স্বাধীন ডিপ্লয়মেন্ট এবং মাইক্রোফ্রন্টএন্ড।
  - রানটাইমে কম্পোনেন্ট শেয়ার।
  - শেয়ারড ডিপেনডেন্সি অপটিমাইজেশন।
- **চ্যালেঞ্জ**:
  - জটিল কনফিগারেশন।
  - রানটাইম পারফরম্যান্স ম্যানেজমেন্ট।

### টার্বোরেপো:
- **সুবিধা**:
  - দ্রুত বিল্ড এবং ক্যাশিং।
  - প্যারালাল টাস্ক এক্সিকিউশন।
  - Vercel-এর রিমোট ক্যাশিং সমর্থন।
- **চ্যালেঞ্জ**:
  - প্রাথমিক সেটআপে শেখার সময় প্রয়োজন।
  - বড় ক্যাশ ফাইল ডিস্ক স্পেস নিতে পারে।

---

## বাস্তব-বিশ্বে ব্যবহারের উদাহরণ

1. **ই-কমার্স প্ল্যাটফর্ম**:
   - মনোরেপো: `store` এবং `admin` অ্যাপ, শেয়ারড `ui` প্যাকেজ।
   - মডিউল ফেডারেশন: `store`-এ `admin`-এর ড্যাশবোর্ড কম্পোনেন্ট লেজি-লোড।
2. **ডকুমেন্টেশন সাইট**:
   - মনোরেপো: `docs` অ্যাপ এবং শেয়ারড `ui` প্যাকেজ।
   - মডিউল ফেডারেশন: শেল অ্যাপে `docs` পেজ লোড।
3. **এন্টারপ্রাইজ ড্যাশবোর্ড**:
   - মনোরেপো: একাধিক টিমের জন্য আলাদা অ্যাপ।
   - মডিউল ফেডারেশন: টিম-নির্দিষ্ট কম্পোনেন্ট শেয়ার।

---

## উপসংহার

Next.js-এ টার্বোরেপোর সাথে মনোরেপো এবং মডিউল ফেডারেশন ব্যবহার করে বড় আকারের অ্যাপ্লিকেশন তৈরি করা সহজ এবং দক্ষ হয়। টার্বোরেপো দ্রুত বিল্ড এবং টাস্ক ম্যানেজমেন্ট নিশ্চিত করে, আর মডিউল ফেডারেশন মাইক্রোফ্রন্টএন্ড আর্কিটেকচারের মাধ্যমে স্বাধীন ডিপ্লয়মেন্ট এবং কোড শেয়ারিং সমর্থন করে। সিনিয়র ডেভেলপার হিসেবে ক্যাশিং, পারফরম্যান্স, এবং সিকিউরিটির দিকে মনোযোগ দিয়ে এই প্যাটার্নগুলো বাস্তবায়ন করুন। টার্বোরেপোর রিমোট ক্যাশিং এবং মডিউল ফেডারেশনের শেয়ারড ডিপেনডেন্সি ব্যবহার করে আপনি স্কেলেবল এবং টিম-ফ্রেন্ডলি Next.js অ্যাপ তৈরি করতে পারেন।[](https://michalzalecki.com/micro-frontends-module-federation-monorepo/)[](https://vercel.com/templates/next.js/microfrontends)[](https://medium.com/%40ignatovich.dm/monorepos-with-turborepo-6aa0852708ee)