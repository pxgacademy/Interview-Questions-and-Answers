# 8. Server actions

Next.js-এ **সার্ভার অ্যাকশনস** (Server Actions) একটি শক্তিশালী এবং আধুনিক ফিচার, যা **App Router**-এর মাধ্যমে সার্ভার-সাইডে ফাংশনালিটি পরিচালনা করতে ব্যবহৃত হয়। এটি ক্লায়েন্ট এবং সার্ভারের মধ্যে ডেটা ইন্টারঅ্যাকশনকে সহজতর করে, বিশেষ করে ফর্ম সাবমিশন, ডাটা মিউটেশন, এবং সার্ভার-সাইড লজিক এক্সিকিউশনের জন্য। সার্ভার অ্যাকশনস ব্যবহার করে আপনি API রাউট তৈরি না করেই সরাসরি সার্ভারে ফাংশন কল করতে পারেন। এটি React-এর সার্ভার কম্পোনেন্টের সাথে ইন্টিগ্রেটেড এবং ফর্ম হ্যান্ডলিংয়ের জন্য একটি সুবিধাজনক উপায় প্রদান করে। সিনিয়র ডেভেলপারদের জন্য সার্ভার অ্যাকশনসের সঠিক ব্যবহার অ্যাপ্লিকেশনের পারফরম্যান্স, সিকিউরিটি, এবং ইউজার এক্সপেরিয়েন্স উন্নত করতে গুরুত্বপূর্ণ। এই বিস্তারিত আলোচনায় আমরা সার্ভার অ্যাকশনসের কাজ, ব্যবহার, এবং সিনিয়র ডেভেলপারদের জন্য গুরুত্বপূর্ণ টিপস নিয়ে আলোচনা করব।

---

## সার্ভার অ্যাকশনস কী?

**সার্ভার অ্যাকশনস** হল Next.js-এর App Router-এর একটি ফিচার, যা সার্ভার-সাইডে ফাংশন ডিফাইন করতে দেয় এবং ক্লায়েন্ট-সাইড থেকে সরাসরি সেই ফাংশন কল করতে সক্ষম করে। এটি `"use server"` ডিরেক্টিভ ব্যবহার করে ডিফাইন করা হয় এবং ফর্ম সাবমিশন বা ডেটা মিউটেশনের জন্য ব্যবহৃত হয়। সার্ভার অ্যাকশনস React-এর ফর্ম অ্যাকশন বা ডাটা ফেচিং প্যাআর্নের সাথে ইন্টিগ্রেট করে এবং API রাউট তৈরির প্রয়োজনীয়তা কমায়। এটি সার্ভার কম্পোনেন্টের সাথে কাজ করে এবং সিকিউর, দ্রুত, এবং ডেভেলপার-ফ্রেন্ডলি সমাধান প্রদান করে।

### মূল বৈশিষ্ট্য:
- **সার্ভার-সাইড এক্সিকিউশন**: অ্যাকশনগুলো সার্ভারে রান করে, যা সংবেদনশীল লজিক (যেমন ডাটাবেস অপারেশন) সুরক্ষিত রাখে।
- **ফর্ম হ্যান্ডলিং**: HTML ফর্ম বা React-এর `useActionState` এবং `useFormStatus` হুকের সাথে সহজ ইন্টিগ্রেশন।
- **প্রোগ্রেসিভ এনহান্সমেন্ট**: জাভাস্ক্রিপ্ট অক্ষম থাকলেও ফর্ম সাবমিশন কাজ করে।
- **এজ রানটাইম সমর্থন**: সার্ভার অ্যাকশন এজ রানটাইমে কাজ করতে পারে, যা লেটেন্সি কমায়।

---

## সার্ভার অ্যাকশনস কিভাবে কাজ করে?

সার্ভার অ্যাকশনস `"use server"` ডিরেক্টিভ ব্যবহার করে সার্ভার-সাইড ফাংশন হিসেবে ডিফাইন করা হয়। এটি ফর্ম অ্যাকশন হিসেবে বা সাধারণ ফাংশন হিসেবে কল করা যায়। Next.js স্বয়ংক্রিয়ভাবে এই অ্যাকশনগুলোকে সার্ভারে রাউট করে এবং ফলাফল ক্লায়েন্টে ফেরত পাঠায়।

### উদাহরণ (ফর্ম হ্যান্ডলিং):

```jsx
// app/actions.js
"use server";

import { db } from "./db";

export async function createUser(formData) {
  const name = formData.get("name");
  const email = formData.get("email");

  // ডাটাবেসে ইউজার সেভ করা
  await db.user.create({
    data: { name, email },
  });

  return { success: true, message: "ইউজার সফলভাবে তৈরি হয়েছে!" };
}
```

```jsx
// app/components/UserForm.js
"use client";
import { createUser } from "../actions";
import { useActionState } from "react";

export default function UserForm() {
  const [state, formAction] = useActionState(createUser, null);

  return (
    <form action={formAction}>
      <input type="text" name="name" placeholder="নাম" required />
      <input type="email" name="email" placeholder="ইমেইল" required />
      <button type="submit">সাবমিট</button>
      {state?.message && <p>{state.message}</p>}
    </form>
  );
}
```

এই কোডে:
- `createUser` সার্ভার অ্যাকশনটি `"use server"` ডিরেক্টিভ দিয়ে ডিফাইন করা হয়েছে।
- ফর্ম ডেটা সার্ভারে পাঠানো হয় এবং ডাটাবেসে সেভ করা হয়।
- `useActionState` হুক ব্যবহার করে ফর্মের স্টেট এবং ফলাফল হ্যান্ডল করা হয়।

### উদাহরণ (সাধারণ ফাংশন কল):

```jsx
// app/actions.js
"use server";

export async function getUser(id) {
  const user = await db.user.findUnique({ where: { id } });
  if (!user) throw new Error("ইউজার পাওয়া যায়নি");
  return user;
}
```

```jsx
// app/components/UserProfile.js
"use client";
import { getUser } from "../actions";
import { useState } from "react";

export default function UserProfile() {
  const [user, setUser] = useState(null);

  async function fetchUser() {
    const userData = await getUser(1);
    setUser(userData);
  }

  return (
    <div>
      <button onClick={fetchUser}>ইউজার ফেচ করুন</button>
      {user && <p>নাম: {user.name}</p>}
    </div>
  );
}
```

এখানে `getUser` সার্ভার অ্যাকশন সরাসরি ক্লায়েন্ট থেকে কল করা হয় এবং ডাটাবেস থেকে ইউজার ডেটা ফেরত আনে।

---

## সার্ভার অ্যাকশনসের বৈশিষ্ট্য

1. **সার্ভার-সাইড এক্সিকিউশন**:
   - অ্যাকশনগুলো সার্ভারে রান করে, যা সংবেদনশীল লজিক (যেমন ডাটাবেস কুয়েরি) সুরক্ষিত রাখে।
   - API রাউট তৈরির প্রয়োজন হয় না।

2. **ফর্ম ইন্টিগ্রেশন**:
   - HTML ফর্ম বা React-এর `useActionState` এবং `useFormStatus` হুকের সাথে সহজে কাজ করে।
   - প্রোগ্রেসিভ এনহান্সমেন্ট সমর্থন করে, যা জাভাস্ক্রিপ্ট ছাড়াও কাজ করে।

3. **এজ রানটাইম সমর্থন**:
   - সার্ভার অ্যাকশন এজ রানটাইমে কাজ করতে পারে।
   - উদাহরণ: `export const runtime = "edge";`

4. **এরর হ্যান্ডলিং**:
   - সার্ভার অ্যাকশন থেকে ফেরত আসা ত্রুটি ক্লায়েন্টে হ্যান্ডল করা যায়।
   - উদাহরণ: `useActionState` দিয়ে এরর স্টেট ম্যানেজ করা।

5. **ডেটা মিউটেশন**:
   - ডাটাবেসে ডেটা তৈরি, আপডেট, বা ডিলিট করার জন্য আদর্শ।
   - উদাহরণ: ফর্ম সাবমিশনের মাধ্যমে ইউজার তৈরি।

---

## ব্যবহারের ক্ষেত্র

1. **ফর্ম সাবমিশন**:
   - ইউজার রেজিস্ট্রেশন, লগইন, বা যোগাযোগ ফর্ম হ্যান্ডলিং।
   - উদাহরণ: ফর্ম ডেটা সার্ভারে সেভ করা।

2. **ডাটা মিউটেশন**:
   - ডাটাবেসে ডেটা তৈরি, আপডেট, বা ডিলিট।
   - উদাহরণ: পোস্ট তৈরি বা ইউজার প্রোফাইল আপডেট।

3. **অথেনটিকেশন**:
   - লগইন বা টোকেন জেনারেশন।
   - উদাহরণ: JWT টোকেন তৈরি এবং কুকি সেট করা।

4. **তৃতীয় পক্ষের API কল**:
   - সার্ভার অ্যাকশনের মাধ্যমে তৃতীয় পক্ষের API থেকে ডেটা ফেচ।
   - উদাহরণ: পেমেন্ট গেটওয়ে ইন্টিগ্রেশন।

5. **রিয়েল-টাইম ইন্টারঅ্যাকশন**:
   - ইউজার ইন্টারঅ্যাকশনের উপর ভিত্তি করে সার্ভার-সাইড ডেটা আপডেট।
   - উদাহরণ: লাইক বা কমেন্ট ফিচার।

---

## সিনিয়র ডেভেলপারদের জন্য গুরুত্বপূর্ণ টিপস

1. **সিকিউরিটি**:
   - **ইনপুট ভ্যালিডেশন**: ফর্ম ডেটা ভ্যালিডেট করতে `zod` বা `yup` ব্যবহার করুন।
     ```jsx
     "use server";
     import { z } from "zod";

     const schema = z.object({
       name: z.string().min(1),
       email: z.string().email(),
     });

     export async function createUser(formData) {
       const validated = schema.parse({
         name: formData.get("name"),
         email: formData.get("email"),
       });
       // ডাটাবেসে সেভ
       return { success: true };
     }
     ```
   - **CSRF সুরক্ষা**: Next.js স্বয়ংক্রিয়ভাবে CSRF সুরক্ষা প্রদান করে, তবে কাস্টম সিকিউরিটি মেকানিজম যোগ করুন।

2. **এরর হ্যান্ডলিং**:
   - সার্ভার অ্যাকশন থেকে ত্রুটি ফেরত দিন এবং ক্লায়েন্টে হ্যান্ডল করুন।
     ```jsx
     "use server";

     export async function createUser(formData) {
       try {
         const name = formData.get("name");
         if (!name) throw new Error("নাম প্রয়োজন");
         // ডাটাবেস অপারেশন
         return { success: true };
       } catch (error) {
         return { error: error.message };
       }
     }
     ```

3. **পারফরম্যান্স অপটিমাইজেশন**:
   - ভারী ডাটাবেস কুয়েরি বা API কল ক্যাশ করুন।
   - এজ রানটাইম ব্যবহার করে লেটেন্সি কমান।
     ```jsx
     export const runtime = "edge";
     ```

4. **প্রোগ্রেসিভ এনহান্সমেন্ট**:
   - জাভাস্ক্রিপ্ট অক্ষম থাকলেও ফর্ম কাজ করবে তা নিশ্চিত করুন।
   - `useFormStatus` ব্যবহার করে লোডিং স্টেট হ্যান্ডল করুন।
     ```jsx
     "use client";
     import { useFormStatus } from "react-dom";

     function SubmitButton() {
       const { pending } = useFormStatus();
       return <button disabled={pending}>{pending ? "সাবমিট হচ্ছে..." : "সাবমিট"}</button>;
     }
     ```

5. **রিভ্যালিডেশন**:
   - ডেটা মিউটেশনের পর ক্যাশ রিফ্রেশ করতে `revalidatePath` বা `revalidateTag` ব্যবহার করুন।
     ```jsx
     "use server";
     import { revalidatePath } from "next/cache";

     export async function createPost(formData) {
       await db.post.create({ data: { title: formData.get("title") } });
       revalidatePath("/posts");
       return { success: true };
     }
     ```

6. **লগিং এবং মনিটরিং**:
   - সার্ভার অ্যাকশনের কার্যকলাপ লগ করুন এবং ত্রুটি ট্র্যাক করতে Sentry বা Datadog ব্যবহার করুন।
     ```jsx
     "use server";

     export async function createUser(formData) {
       try {
         console.log("Creating user:", formData.get("email"));
         // ডাটাবেস অপারেশন
         return { success: true };
       } catch (error) {
         console.error("Error creating user:", error);
         throw error;
       }
     }
     ```

7. **টেস্টিং**:
   - সার্ভার অ্যাকশন টেস্ট করতে Jest বা Playwright ব্যবহার করুন।
   - ফর্ম সাবমিশন এবং এরর কেস টেস্ট করুন।

---

## সুবিধা এবং চ্যালেঞ্জ

### সুবিধা:
- **API রাউটের প্রয়োজন নেই**: সার্ভার অ্যাকশন সরাসরি সার্ভার-সাইড লজিক হ্যান্ডল করে।
- **সিকিউরিটি**: সংবেদনশীল লজিক সার্ভারে থাকে।
- **ফর্ম হ্যান্ডলিং**: ফর্ম সাবমিশন সহজ এবং প্রোগ্রেসিভ এনহান্সমেন্ট সমর্থন করে।
- **এজ রানটাইম**: দ্রুত প্রসেসিংয়ের জন্য এজ রানটাইম সমর্থন।

### চ্যালেঞ্জ:
- **জটিলতা**: জটিল ফর্ম হ্যান্ডলিংয়ে অতিরিক্ত স্টেট ম্যানেজমেন্ট প্রয়োজন।
- **এজ রানটাইম লিমিটেশন**: এজ রানটাইমে কিছু Node.js API (যেমন `fs`) ব্যবহার করা যায় না।
- **লার্নিং কার্ভ**: `useActionState` এবং `useFormStatus` বোঝা নতুন ডেভেলপারদের জন্য চ্যালেঞ্জিং হতে পারে।

---

## বাস্তব-বিশ্বে ব্যবহারের উদাহরণ

1. **ইউজার রেজিস্ট্রেশন**:
   - ফর্ম সাবমিশনের মাধ্যমে ইউজার তৈরি এবং ডাটাবেসে সেভ।
   - উদাহরণ: রেজিস্ট্রেশন ফর্ম।

2. **পোস্ট তৈরি**:
   - ব্লগ পোস্ট তৈরি এবং ক্যাশ রিভ্যালিডেশন।
   - উদাহরণ: নতুন পোস্ট সাবমিট করা।

3. **অথেনটিকেশন**:
   - লগইন ফর্মের মাধ্যমে টোকেন জেনারেশন এবং কুকি সেট।
   - উদাহরণ: JWT-ভিত্তিক লগইন।

4. **পেমেন্ট প্রসেসিং**:
   - ফর্ম সাবমিশনের মাধ্যমে পেমেন্ট গেটওয়ে API কল।
   - উদাহরণ: Stripe-এর মাধ্যমে পেমেন্ট।

5. **ডেটা আপডেট**:
   - ইউজার প্রোফাইল বা পোস্ট আপডেট।
   - উদাহরণ: প্রোফাইল এডিট ফর্ম।

---

## উপসংহার

সার্ভার অ্যাকশনস Next.js-এর App Router-এর একটি শক্তিশালী ফিচার, যা ক্লায়েন্ট-সার্ভার ইন্টারঅ্যাকশনকে সহজ করে এবং API রাউটের প্রয়োজনীয়তা কমায়। এটি ফর্ম হ্যান্ডলিং, ডেটা মিউটেশন, এবং সার্ভার-সাইড লজিক পরিচালনার জন্য আদর্শ। সিনিয়র ডেভেলপার হিসেবে সিকিউরিটি, পারফরম্যান্স, এবং এরর হ্যান্ডলিংয়ের দিকে মনোযোগ দিয়ে সার্ভার অ্যাকশন ডিজাইন করুন। `useActionState`, `useFormStatus`, এবং `revalidatePath`-এর সঠিক ব্যবহারের মাধ্যমে আপনি দ্রুত, নিরাপদ, এবং ইউজার-ফ্রেন্ডলি Next.js অ্যাপ তৈরি করতে পারেন।