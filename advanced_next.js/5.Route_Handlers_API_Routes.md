# 5. Route Handlers / API Routes


Next.js-এ **রাউট হ্যান্ডলার্স** (Route Handlers) বা **API রাউটস** একটি শক্তিশালী ফিচার, যা ডেভেলপারদেরকে সার্ভারলেস API তৈরি করতে সক্ষম করে। এটি Next.js অ্যাপ্লিকেশনের মধ্যে সরাসরি API এন্ডপয়েন্ট তৈরি করার জন্য ব্যবহৃত হয়, যা বাহ্যিক সার্ভার ছাড়াই HTTP রিকোয়েস্ট (যেমন GET, POST, PUT, DELETE) হ্যান্ডল করতে পারে। **App Router**-এর মাধ্যমে রাউট হ্যান্ডলার্স এবং **Pages Router**-এর মাধ্যমে API রাউটস নামে পরিচিত এই ফিচারটি অ্যাপ্লিকেশনের ব্যাকএন্ড লজিক পরিচালনার জন্য অত্যন্ত কার্যকর। সিনিয়র ডেভেলপারদের জন্য এই কনসেপ্টটি বোঝা এবং সঠিকভাবে প্রয়োগ করা অ্যাপ্লিকেশনের স্কেলেবিলিটি, সিকিউরিটি এবং পারফরম্যান্স বাড়াতে সহায়ক। এই বিস্তারিত আলোচনায় আমরা রাউট হ্যান্ডলার্স / API রাউটসের কাজ, ব্যবহার, এবং সিনিয়র ডেভেলপারদের জন্য গুরুত্বপূর্ণ টিপস নিয়ে আলোচনা করব।

---

## রাউট হ্যান্ডলার্স / API রাউটস কী?

রাউট হ্যান্ডলার্স বা API রাউটস হল Next.js-এর একটি ফিচার, যা `app` বা `pages/api` ডিরেক্টরির মধ্যে ফাইল তৈরি করে API এন্ডপয়েন্ট ডিফাইন করতে দেয়। এটি সার্ভারলেস ফাংশন হিসেবে কাজ করে এবং HTTP মেথড (GET, POST, PUT, DELETE ইত্যাদি) হ্যান্ডল করতে পারে। এটি ফ্রন্টএন্ড এবং ব্যাকএন্ডের মধ্যে একটি সেতু হিসেবে কাজ করে, যেখানে আপনি ডাটাবেস কুয়েরি, তৃতীয় পক্ষের API কল, বা অন্যান্য ব্যাকএন্ড লজিক পরিচালনা করতে পারেন।

### **Pages Router** এবং **App Router** এর পার্থক্য:
- **Pages Router**: `pages/api` ডিরেক্টরিতে ফাইল তৈরি করে API রাউট ডিফাইন করা হয়। উদাহরণস্বরূপ, `pages/api/hello.js` ফাইল `/api/hello` এন্ডপয়েন্ট তৈরি করে।
- **App Router**: `app/api` ডিরেক্টরিতে `route.js` ফাইল তৈরি করে রাউট হ্যান্ডলার ডিফাইন করা হয়। এটি আরও নমনীয় এবং এজ রানটাইমের সাথে সামঞ্জস্যপূর্ণ।

---

## কিভাবে কাজ করে?

### ১. **Pages Router-এ API রাউটস**:
Pages Router-এ `pages/api` ডিরেক্টরিতে একটি ফাইল তৈরি করা হয়, যা একটি ফাংশন এক্সপোর্ট করে। এই ফাংশনটি `req` (রিকোয়েস্ট) এবং `res` (রেসপন্স) প্যারামিটার গ্রহণ করে।

#### উদাহরণ:

```jsx
// pages/api/hello.js
export default function handler(req, res) {
  if (req.method === "GET") {
    res.status(200).json({ message: "হ্যালো থেকে API!" });
  } else if (req.method === "POST") {
    const { name } = req.body;
    res.status(200).json({ message: `হ্যালো, ${name}!` });
  } else {
    res.setHeader("Allow", ["GET", "POST"]);
    res.status(405).end(`Method ${req.method} Not Allowed`);
  }
}
```

এই কোডটি `/api/hello` এন্ডপয়েন্টে GET এবং POST রিকোয়েস্ট হ্যান্ডল করে।

### ২. **App Router-এ রাউট হ্যান্ডলার্স**:
App Router-এ `app/api` ডিরেক্টরিতে `route.js` ফাইল তৈরি করা হয়। এখানে প্রতিটি HTTP মেথডের জন্য আলাদা ফাংশন (GET, POST, ইত্যাদি) এক্সপোর্ট করা হয়। এটি `NextResponse` বা `Response` অবজেক্ট ব্যবহার করে রেসপন্স ফেরত দেয়।

#### উদাহরণ:

```jsx
// app/api/hello/route.js
import { NextResponse } from "next/server";

export async function GET() {
  return NextResponse.json({ message: "হ্যালো থেকে API!" }, { status: 200 });
}

export async function POST(request) {
  const { name } = await request.json();
  return NextResponse.json({ message: `হ্যালো, ${name}!` }, { status: 200 });
}
```

এই কোডটি `/api/hello` এন্ডপয়েন্টে GET এবং POST রিকোয়েস্ট হ্যান্ডল করে।

---

## রাউট হ্যান্ডলার্স / API রাউটসের বৈশিষ্ট্য

1. **HTTP মেথড সমর্থন**:
   - GET, POST, PUT, DELETE, PATCH ইত্যাদি মেথড হ্যান্ডল করা যায়।
   - App Router-এ প্রতিটি মেথডের জন্য আলাদা ফাংশন (যেমন `GET`, `POST`) ডিফাইন করা যায়।

2. **সার্ভারলেস আর্কিটেকচার**:
   - রাউট হ্যান্ডলার্স Vercel-এর মতো প্ল্যাটফর্মে সার্ভারলেস ফাংশন হিসেবে রান করে।
   - এটি স্কেলেবিলিটি এবং রক্ষণাবেক্ষণের সুবিধা দেয়।

3. **এজ রানটাইম**:
   - App Router-এ রাউট হ্যান্ডলার্স এজ রানটাইমে কাজ করতে পারে, যা কম লেটেন্সি প্রদান করে।
   - উদাহরণ: `export const runtime = "edge";`

4. **ডায়নামিক রাউটিং**:
   - `[id]/route.js` এর মতো ফাইল তৈরি করে ডায়নামিক API এন্ডপয়েন্ট তৈরি করা যায়।
   - উদাহরণ: `app/api/users/[id]/route.js` `/api/users/123` এন্ডপয়েন্ট তৈরি করবে।

5. **ইনপুট প্রসেসিং**:
   - রিকোয়েস্ট বডি, কুয়েরি প্যারামিটার, হেডার ইত্যাদি অ্যাক্সেস করা যায়।
   - উদাহরণ:

```jsx
// app/api/users/[id]/route.js
import { NextResponse } from "next/server";

export async function-гेट(request, { params }) {
  const { id } = params;
  const res = await fetch(`https://api.example.com/users/${id}`);
  const user = await res.json();
  return NextResponse.json(user);
}
```

---

## ব্যবহারের ক্ষেত্র

1. **ডাটাবেস অপারেশন**:
   - ডাটাবেস থেকে ডেটা ফেচ, সেভ, বা আপডেট করা।
   - উদাহরণ: ইউজার প্রোফাইল তৈরি বা পোস্ট লিস্ট ফেচ।

2. **তৃতীয় পক্ষেরixeira

3. **অথেনটিকেশন**:
   - JWT বা OAuth টোকেন যাচাই করা।
   - উদাহরণ: লগইন API এন্ডপয়েন্ট।

4. **ফর্ম হ্যান্ডলিং**:
   - ফর্ম সাবমিশন প্রসেস করা।
   - উদাহরণ: যোগাযোগ ফর্মের ডেটা সেভ।

5. **প্রক্সি API**:
   - তৃতীয় পক্ষের API কল ম্যানেজ করা, যেমন পেমেন্ট গেটওয়ে।

---

## সিনিয়র ডেভেলপারদের জন্য গুরুত্বপূর্ণ টিপস

1. **সিকিউরিটি**:
   - **ইনপুট ভ্যালিডেশন**: রিকোয়েস্ট ডেটা ভ্যালিডেট করুন।
   - **CORS**: `Access-Control-Allow-Origin` হেডার সেট করুন।
     ```jsx
     export async function GET(request) {
       return new Response(JSON.stringify({ message: "Hello" }), {
         headers: {
           "Access-Control-Allow-Origin": "*",
           "Content-Type": "application/json",
         },
       });
     }
     ```
   - **রেট লিমিটিং**: API অ্যাবিউজ রোধে রেট লিমিটিং প্রয়োগ করুন।

2. **এরর হ্যান্ডলিং**:
   - সঠিক এরর কোড এবং মেসেজ রিটার্ন করুন।
     ```jsx
     export async function GET() {
       try {
         const data = await fetchData();
         return NextResponse.json(data);
       } catch (error) {
         return NextResponse.json({ error: "Internal Server Error" }, { status: 500 });
       }
     }
     ```

3. **পারফরম্যান্স অপটিমাইজেশন**:
   - **ক্যাশিং**: API রেসপন্স ক্যাশ করতে `Cache-Control` হেডার ব্যবহার করুন।
     ```jsx
     return new Response(JSON.stringify(data), {
       headers: { "Cache-Control": "s-maxage=3600" },
     });
     ```
   - **এজ রানটাইম**: App Router-এ `runtime: "edge"` ব্যবহার করে লেটেন্সি কমান।

4. **ডায়নামিক রাউট**:
   - ডায়নামিক API এন্ডপয়েন্ট তৈরি করতে `[id]/route.js` ব্যবহার করুন।
   - প্যারামিটার ভ্যালিডেশন নিশ্চিত করুন।

5. **অথেনটিকেশন**:
   - API এন্ডপয়েন্টে JWT বা API কী যাচাই করুন।
     ```jsx
     export async function GET(request) {
       const token = request.headers.get("authorization");
       if (!token) {
         return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
       }
       // টোকেন যাচাই
       return NextResponse.json({ message: "Success" });
     }
     ```

6. **লগিং এবং মনিটরিং**:
   - API রিকোয়েস্ট লগ করুন এবং ত্রুটি ট্র্যাক করতে Sentry বা Datadog ব্যবহার করুন।
   - উদাহরণ:

```jsx
export async function POST(request) {
  try {
    const data = await request.json();
    console.log("Request received:", data);
    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Error:", error);
    return NextResponse.json({ error: "Invalid request" }, { status: 400 });
  }
}
```

---

## সুবিধা এবং চ্যালেঞ্জ

### সুবিধা:
- **সার্ভারলেস**: আলাদা ব্যাকএন্ড সার্ভারের প্রয়োজন নেই।
- **নমনীয়তা**: যেকোনো ধরনের HTTP রিকোয়েস্ট হ্যান্ডল করা যায়।
- **এজ রানটাইম**: App Router-এ এজ কম্পিউটিংয়ের সুবিধা।
- **ইন্টিগ্রেশন**: ফ্রন্টএন্ড এবং ব্যাকএন্ড একই প্রোজেক্টে।

### চ্যালেঞ্জ:
- **সিকিউরিটি**: API এন্ডপয়েন্ট সুরক্ষিত করা জটিল হতে পারে।
- **স্কেলিং**: উচ্চ ট্রাফিকের জন্য ক্যাশিং এবং রেট লিমিটিং প্রয়োজন।
- **এরর হ্যান্ডলিং**: সঠিক এরর মেসেজ এবং স্ট্যাটাস কোড নিশ্চিত করা।

---

## বাস্তব-বিশ্বে ব্যবহারের উদাহরণ

1. **ইউজার ম্যানেজমেন্ট**:
   - `/api/users` এন্ডপয়েন্টে ইউজার তৈরি, আপডেট, বা ডিলিট।
   - উদাহরণ: POST রিকোয়েস্টে ইউজার ডেটা সেভ।

2. **ডাটাবেস কুয়েরি**:
   - `/api/posts` এন্ডপয়েন্টে ডাটাবেস থেকে পোস্ট ফেচ।
   - উদাহরণ: GET রিকোয়েস্টে পোস্ট লিস্ট রিটার্ন।

3. **পেমেন্ট প্রসেসিং**:
   - `/api/payment` এন্ডপয়েন্টে পেমেন্ট গেটওয়ে API কল।
   - উদাহরণ: Stripe API-এর মাধ্যমে পেমেন্ট প্রসেস।

4. **অথেনটিকেশন**:
   - `/api/login` এন্ডপয়েন্টে লগইন রিকোয়েস্ট হ্যান্ডল।
   - উদাহরণ: JWT টোকেন জেনারেট।

---

## উপসংহার

রাউট হ্যান্ডলার্স / API রাউটস Next.js-এর একটি শক্তিশালী ফিচার, যা সার্ভারলেস API তৈরির সুবিধা দেয়। এটি ফ্রন্টএন্ড এবং ব্যাকএন্ডের মধ্যে সংযোগ স্থাপন করে এবং ডাটাবgeries, অথেনটিকেশন, এবং তৃতীয় পক্ষের API ইন্টিগ্রেশনের জন্য আদর্শ। সিনিয়র ডেভেলপার হিসেবে সিকিউরিটি, পারফরম্যান্স, এবং এরর হ্যান্ডলিংয়ের দিকে বিশেষ মনোযোগ দিয়ে রাউট হ্যান্ডলার্স ডিজাইন করুন। App Router-এর এজ রানটাইম এবং ক্যাশিং ফিচার ব্যবহার করে দ্রুত এবং স্কেলেবল API তৈরি করুন।